import"../chunks/Bzak7iHL.js";import{p as ls,o as is,x as cs,f as w,y as q,A as a,c as b,d as vs,B as o,D as c,E as r,l as n,v as G,F as l,H as ds,z as us,C as K}from"../chunks/D6nPkcoS.js";import{i as F,s as ps,a as hs}from"../chunks/BDAMK1gS.js";import{e as gs,b as L,s as k,a as x}from"../chunks/D73Bnykk.js";import{r as O}from"../chunks/DRPFIkrd.js";import{i as J,g as E,s as m}from"../chunks/B5_lSiN-.js";import{g as bs}from"../chunks/CwdQBBZU.js";var ms=w('<div class="empty-state svelte-1sgss7h"><p>No groups yet. Create one or join an existing group!</p></div>'),fs=w('<div class="group-card svelte-1sgss7h" role="button" tabindex="0"><div class="group-info svelte-1sgss7h"><h3 class="group-name svelte-1sgss7h"> </h3> <p class="group-members svelte-1sgss7h"> </p></div> <button class="btn btn-small btn-outline svelte-1sgss7h">Copy Join Code</button></div>'),_s=w('<div class="modal-overlay svelte-1sgss7h" role="button" tabindex="0"><div class="modal svelte-1sgss7h" role="dialog" tabindex="0"><h3 class="svelte-1sgss7h">Create New Group</h3> <input placeholder="Group name" class="modal-input svelte-1sgss7h"/> <div class="modal-actions svelte-1sgss7h"><button class="btn btn-secondary svelte-1sgss7h">Cancel</button> <button class="btn btn-primary svelte-1sgss7h">Create</button></div></div></div>'),ys=w('<div class="modal-overlay svelte-1sgss7h" role="button" tabindex="0"><div class="modal svelte-1sgss7h" role="dialog" tabindex="0"><h3 class="svelte-1sgss7h">Join Group</h3> <input placeholder="Paste join code here" class="modal-input svelte-1sgss7h"/> <div class="modal-actions svelte-1sgss7h"><button class="btn btn-secondary svelte-1sgss7h">Cancel</button> <button class="btn btn-primary svelte-1sgss7h">Join</button></div></div></div>'),ks=w('<div class="groups-view svelte-1sgss7h"><header class="groups-header svelte-1sgss7h"><h1 class="svelte-1sgss7h">Groups</h1> <div class="group-actions svelte-1sgss7h"><button class="btn btn-primary svelte-1sgss7h">Create Group</button> <button class="btn btn-secondary svelte-1sgss7h">Join Group</button></div></header> <div class="groups-list svelte-1sgss7h"><!></div></div> <!> <!>',1);function Js(Q,f){ls(f,!0);const N=()=>hs(E,"$groups",R),[R,S]=ps();let _=G(""),y=G(""),h=G(!1),g=G(!1),D;async function C(){try{const s=await J("get_groups");console.log("groups loaded: ",s),E.set(s)}catch(s){console.error("Failed to load groups:",s)}}async function U(){try{const s=await J("create_group",{name:n(_)});console.log("[ts] created group, chatId: {}",s);const e={chatId:s,name:n(_),memberCount:1};E.update(i=>[...i,e]),l(h,!1),l(_,""),await C(),m("Group created successfully!")}catch(s){console.error("Failed to create group:",s),m("Failed to create group",!0)}}async function V(){if(n(y).trim())try{await J("join_group",{chatId:n(y)}),l(g,!1),l(y,""),await C(),m("Group joined successfully!")}catch(s){console.error("Failed to join group:",s),m("Failed to join group",!0)}}async function W(s){try{await navigator.clipboard.writeText(s),m("Join code copied to clipboard!")}catch(e){console.error("Failed to copy join code:",e),m("Failed to copy join code",!0)}}function M(s){bs(`/chat/${s.chatId}`)}is(async()=>{await C(),D=setInterval(async()=>{await C()},3e3)}),cs(()=>{clearInterval(D)});var P=ks(),j=q(P),I=o(j),T=c(o(I),2),z=o(T),X=c(z,2);r(T),r(I);var A=c(I,2),Y=o(A);{var Z=s=>{var e=ms();b(s,e)},$=s=>{var e=ds(),i=q(e);gs(i,1,N,d=>d.chatId,(d,v)=>{var u=fs(),p=o(u),t=o(p),as=o(t,!0);r(t);var H=c(t,2),os=o(H);r(H),r(p);var rs=c(p,2);r(u),us(()=>{K(as,n(v).name),K(os,`${n(v).memberCount??""} member${n(v).memberCount!==1?"s":""}`)}),a("click",rs,k(()=>W(n(v).chatId))),a("click",u,()=>M(n(v))),a("keydown",u,ns=>ns.key==="Enter"&&M(n(v))),b(d,u)}),b(s,e)};F(Y,s=>{N().length===0?s(Z):s($,!1)})}r(A),r(j);var B=c(j,2);{var ss=s=>{var e=_s(),i=o(e),d=c(o(i),2);O(d);var v=c(d,2),u=o(v),p=c(u,2);r(v),r(i),r(e),L(d,()=>n(_),t=>l(_,t)),a("click",u,()=>l(h,!1)),a("click",p,U),a("click",i,k(function(t){x.call(this,f,t)})),a("keydown",i,k(function(t){x.call(this,f,t)})),a("click",e,()=>l(h,!1)),a("keydown",e,t=>t.key==="Escape"&&l(h,!1)),b(s,e)};F(B,s=>{n(h)&&s(ss)})}var es=c(B,2);{var ts=s=>{var e=ys(),i=o(e),d=c(o(i),2);O(d);var v=c(d,2),u=o(v),p=c(u,2);r(v),r(i),r(e),L(d,()=>n(y),t=>l(y,t)),a("click",u,()=>l(g,!1)),a("click",p,V),a("click",i,k(function(t){x.call(this,f,t)})),a("keydown",i,k(function(t){x.call(this,f,t)})),a("click",e,()=>l(g,!1)),a("keydown",e,t=>t.key==="Escape"&&l(g,!1)),b(s,e)};F(es,s=>{n(g)&&s(ts)})}a("click",z,()=>{console.log("create group opened"),l(h,!0)}),a("click",X,()=>l(g,!0)),b(Q,P),vs(),S()}export{Js as component};
